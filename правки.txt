# –ó–ê–î–ê–ß–ê: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –º–µ–¥–∏–∞ –¥–ª—è –ø–æ—Å—Ç–æ–≤ –±–µ–∑ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

## –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ë–õ–ï–ú–´
–ë–æ—Ç –ø—É–±–ª–∏–∫—É–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã (—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ), –¥—Ä—É–≥–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç. –°–µ–π—á–∞—Å –¥–ª—è –ø–æ—Å—Ç–æ–≤ –ë–ï–ó –º–µ–¥–∏–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ "–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç —Å –º–µ–¥–∏–∞", —Ö–æ—Ç—è –º–µ–¥–∏–∞ —Ç–∞–º –Ω–µ—Ç.

## –ß–¢–û –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨

### 1. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –ø—É–±–ª–∏–∫—É–µ–º—ã—Ö –ø–æ—Å—Ç–∞—Ö
**–§–∞–π–ª:** `src/cars_bot/publishing/service.py`
**–ú–µ—Ç–æ–¥:** `format_post` (—Å—Ç—Ä–æ–∫–∞ ~138)

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
```python
post_text += f"\n\nüìû <a href='{contact_link}'>–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã</a>"
```

**–¢—Ä–µ–±—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ï—Å–ª–∏ –≤ –ø–æ—Å—Ç–µ –ï–°–¢–¨ –º–µ–¥–∏–∞ ‚Üí —Ç–µ–∫—Å—Ç: "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç —Å –º–µ–¥–∏–∞"
- –ï—Å–ª–∏ –≤ –ø–æ—Å—Ç–µ –ù–ï–¢ –º–µ–¥–∏–∞ ‚Üí —Ç–µ–∫—Å—Ç: "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã"

**–ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–µ–¥–∏–∞:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—ä–µ–∫—Ç `car_data.post` –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `has_media: bool`:
- `post.message_ids` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
- –ò–õ–ò `post.media_files` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

### 2. –°–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –º–µ–¥–∏–∞
**–§–∞–π–ª:** `src/cars_bot/bot/handlers/contacts_handler.py`
**–§—É–Ω–∫—Ü–∏—è:** `_format_contacts_with_keyboard` (—Å—Ç—Ä–æ–∫–∏ 225-226)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
# Add original message link
if post.original_message_link:
    contacts_text += f"üìù <a href='{post.original_message_link}'>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>\n\n"
```

**–¢—Ä–µ–±—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
```python
# Add original message link ONLY if post has media
has_media = bool(post.message_ids) or bool(post.media_files)
if post.original_message_link and has_media:
    contacts_text += f"üìù <a href='{post.original_message_link}'>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å –º–µ–¥–∏–∞</a>\n\n"
```

## –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò

‚úÖ –î–ª—è –ø–æ—Å—Ç–æ–≤ –ë–ï–ó –º–µ–¥–∏–∞:
- –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∫–∞–Ω–∞–ª–µ: "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã"
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: –ù–ï–¢ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç

‚úÖ –î–ª—è –ø–æ—Å—Ç–æ–≤ –° –º–µ–¥–∏–∞:
- –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∫–∞–Ω–∞–ª–µ: "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç —Å –º–µ–¥–∏–∞"
- –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: –ï–°–¢–¨ —Å—Å—ã–ª–∫–∞ "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å –º–µ–¥–∏–∞"

## –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

**–ú–æ–¥–µ–ª—å Post** (src/cars_bot/database/models/post.py):
- `message_ids: Optional[list[int]]` ‚Äî ID —Å–æ–æ–±—â–µ–Ω–∏–π —Å –º–µ–¥–∏–∞
- `media_files: Optional[list[str]]` ‚Äî file_id –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
- `original_message_link: Optional[str]` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç

**–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–¥–∏–∞:**
```python
def has_media(post: Post) -> bool:
    return bool(post.message_ids) or bool(post.media_files)
```

## –®–ê–ì–ò –í–´–ü–û–õ–ù–ï–ù–ò–Ø

1. –í `publishing/service.py`:
   - –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `has_media` –≤ –º–µ—Ç–æ–¥ `format_post` –ò–õ–ò –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–µ–¥–∏–∞ —á–µ—Ä–µ–∑ —Å–≤—è–∑—å —Å post
   - –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç –≥–∏–ø–µ—Ä—Å—Å—ã–ª–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `has_media`
   - –û–±–Ω–æ–≤–∏—Ç—å –≤—ã–∑–æ–≤ `format_post` –≤ –º–µ—Ç–æ–¥–µ `publish_to_channel` (–ø–µ—Ä–µ–¥–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ–¥–∏–∞)

2. –í `contacts_handler.py`:
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `has_media` –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç (—Å—Ç—Ä–æ–∫–∞ 225)
   - –ò–∑–º–µ–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ "–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å –º–µ–¥–∏–∞" –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏

3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
   - –ü–æ—Å—Ç –±–µ–∑ –º–µ–¥–∏–∞ ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å—Å—ã–ª–∫–∏ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö
   - –ü–æ—Å—Ç —Å –º–µ–¥–∏–∞ ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∏ –Ω–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–∫–∏ –≤ –∫–æ–Ω—Ç–∞–∫—Ç–∞—Ö
