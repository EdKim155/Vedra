# üîí –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ Invite Links

## –î–∞—Ç–∞: 2025-10-27

---

## üéØ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã Telegram** —á–µ—Ä–µ–∑ invite-—Å—Å—ã–ª–∫–∏ –≤–∏–¥–∞:
- `https://t.me/+CODE`
- `https://t.me/joinchat/CODE`

---

## üìã –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—É–±–ª–∏—á–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (–∫–∞–∫ —Ä–∞–Ω—å—à–µ):
```
@channelname
https://t.me/channelname
```

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (–ù–û–í–û–ï):
```
https://t.me/+pfBTDBt_C98zNjMy
https://t.me/joinchat/AaBbCcDdEe
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω—ã —É—Ç–∏–ª–∏—Ç—ã (`monitor/utils.py`)

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

```python
is_invite_link(link: str) -> bool
"""–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å—Å—ã–ª–∫–∞ invite link"""

extract_invite_hash(link: str) -> Optional[str]
"""–ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ö–µ—à –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –∏–∑ —Å—Å—ã–ª–∫–∏"""
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è:**

```python
normalize_channel_username(username: str) -> str
"""
–¢–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
- @channelname ‚Üí "channelname"
- https://t.me/channelname ‚Üí "channelname"
- https://t.me/+CODE ‚Üí "+CODE" (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç + –¥–ª—è invite link)
"""
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä (`monitor/monitor.py`)

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥:**

```python
async def _join_via_invite(invite_link: str) -> Optional[Channel]
"""
–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–∞–Ω–∞–ª—É —á–µ—Ä–µ–∑ invite link.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç ImportChatInviteRequest –∏–∑ Telethon.
"""
```

**–û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥:**

```python
async def _add_channel(channel: DBChannel) -> None
"""
–¢–µ–ø–µ—Ä—å:
1. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∫–∞–Ω–∞–ª–∞ (–ø—É–±–ª–∏—á–Ω—ã–π/–ø—Ä–∏–≤–∞—Ç–Ω—ã–π)
2. –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ invite link
3. –î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
"""
```

---

## üìù –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Google Sheets

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª–∏—Å—Ç **"–ö–∞–Ω–∞–ª—ã"**
2. –í —Å—Ç–æ–ª–±—Ü–µ **"Username –∫–∞–Ω–∞–ª–∞"** –≤—Å—Ç–∞–≤—å—Ç–µ invite link:
   ```
   https://t.me/+pfBTDBt_C98zNjMy
   ```
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **"–ê–∫—Ç–∏–≤–µ–Ω"** = `TRUE`
4. –ß–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É —Å–∏—Å—Ç–µ–º–∞:
   - –û–ø—Ä–µ–¥–µ–ª–∏—Ç —á—Ç–æ —ç—Ç–æ invite link
   - –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—Å—è –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–∞–Ω–∞–ª—É
   - –ù–∞—á–Ω–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç

```python
from cars_bot.database.models.channel import Channel
from cars_bot.database.session import get_db_manager

channel = Channel(
    channel_id="+pfBTDBt_C98zNjMy",  # Invite hash —Å +
    channel_username="pfBTDBt_C98zNjMy",
    channel_title="PerekupOfficial",
    is_active=True
)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
async with get_db_manager().session() as session:
    session.add(channel)
    await session.commit()
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª

```bash
# –í Google Sheets:
1. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –≤ "–ö–∞–Ω–∞–ª—ã":
   Username –∫–∞–Ω–∞–ª–∞: https://t.me/+pfBTDBt_C98zNjMy
   –ê–∫—Ç–∏–≤–µ–Ω: TRUE

2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –º–æ–Ω–∏—Ç–æ—Ä–∞:
   tail -f logs/monitor_output.log | grep "invite"

4. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   üìé Detected invite link for private channel
   üîó Joining private channel via invite
   ‚úÖ Successfully joined private channel: PerekupOfficial
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
tail -f logs/monitor_output.log

# –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   üì® New message from PerekupOfficial
   ‚úÖ Queued post for processing
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. Invite link –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑

–ï—Å–ª–∏ –∞–∫–∫–∞—É–Ω—Ç —É–∂–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ –∫–∞–Ω–∞–ª—É, –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ invite link –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É. –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å entity –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º.

### 2. –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –Ω–µ –∏–º–µ—é—Ç username

–í –ª–æ–≥–∞—Ö –æ–Ω–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–∫:
```
‚úÖ Added channel: PerekupOfficial (@PRIVATE) [ID: 2043858090]
```

### 3. Rate limiting

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–∞–Ω–∞–ª–∞–º –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è rate limiting:
- –ú–∞–∫—Å 20 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–∞—É–∑–∞

### 4. –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è invite link

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ invite links –º–æ–≥—É—Ç –∏–º–µ—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è. –ï—Å–ª–∏ link —É—Å—Ç–∞—Ä–µ–ª, –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –æ—à–∏–±–∫—É `INVITE_HASH_EXPIRED`.

---

## üìä –§–æ—Ä–º–∞—Ç –≤ –ë–î

### –ü—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª:
```sql
channel_id: "@channelname"
channel_username: "channelname"
```

### –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª:
```sql
channel_id: "+pfBTDBt_C98zNjMy"
channel_username: "pfBTDBt_C98zNjMy"
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to join private channel via invite link"

**–ü—Ä–∏—á–∏–Ω—ã:**
1. Invite link —É—Å—Ç–∞—Ä–µ–ª
2. –ê–∫–∫–∞—É–Ω—Ç —É–∂–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω –∫ –∫–∞–Ω–∞–ª—É
3. –ö–∞–Ω–∞–ª –±—ã–ª —É–¥–∞–ª–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π:
tail -100 logs/monitor_output.log | grep "invite\|private"

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π invite link –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞–Ω–∞–ª–∞
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Could not extract invite hash"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
```
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å—Å—ã–ª–∫–∞ –∏–º–µ–µ—Ç —Ñ–æ—Ä–º–∞—Ç:
‚úÖ https://t.me/+pfBTDBt_C98zNjMy
‚úÖ https://t.me/joinchat/pfBTDBt_C98zNjMy
‚ùå t.me/+pfBTDBt_C98zNjMy (–±–µ–∑ https://)
‚ùå https://t.me/channelname (—ç—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª)
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Flood wait error"

**–ü—Ä–∏—á–∏–Ω–∞:** –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API

**–†–µ—à–µ–Ω–∏–µ:**
```
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–æ–∂–¥–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

```bash
# 1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
scp src/cars_bot/monitor/utils.py carsbot:/root/cars-bot/src/cars_bot/monitor/
scp src/cars_bot/monitor/monitor.py carsbot:/root/cars-bot/src/cars_bot/monitor/

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä
ssh carsbot "supervisorctl restart carsbot:cars-monitor"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
ssh carsbot "tail -f /root/cars-bot/logs/monitor_output.log"
```

---

## üìà –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### PerekupOfficial –∫–∞–Ω–∞–ª

**Invite link:** https://t.me/+pfBTDBt_C98zNjMy

**–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ Google Sheets ‚Üí "–ö–∞–Ω–∞–ª—ã"
2. –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
   - **ID**: (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - **Username –∫–∞–Ω–∞–ª–∞**: `https://t.me/+pfBTDBt_C98zNjMy`
   - **–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞**: `PerekupOfficial`
   - **–ê–∫—Ç–∏–≤–µ–Ω**: `TRUE`
   - **–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è**: (–∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

3. –ß–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
tail -f logs/monitor_output.log
```

4. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üìé Detected invite link for private channel
üîó Joining private channel via invite: pfBTDBt_C9...
‚úÖ Successfully joined private channel: PerekupOfficial [ID: 2043858090]
‚úÖ Added channel: PerekupOfficial (@PRIVATE) [ID: 2043858090]
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ invite links
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–∞–Ω–∞–ª–∞–º
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ Rate limiting –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: 2025-10-27

