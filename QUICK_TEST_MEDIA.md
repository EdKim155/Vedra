# –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –º–µ–¥–∏–∞

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –í –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
cd "/Users/edgark/CARS BOT"

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Celery
./scripts/stop_celery.sh

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä
pkill -f check_monitor.py
sleep 2
nohup python check_monitor.py > logs/monitor_output.log 2>&1 &

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery worker
./scripts/start_celery_worker.sh

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Celery beat
./scripts/start_celery_beat.sh
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –æ–¥–∏–Ω –∏–∑ –º–æ–Ω–∏—Ç–æ—Ä–∏–º—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –ø–æ—Å—Ç —Å:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –û–¥–Ω–æ —Ñ–æ—Ç–æ**
```
–ü—Ä–æ–¥–∞–º BMW X5 2015, 3.0 –¥–∏–∑–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç
–ü—Ä–æ–±–µ–≥ 120–∫, 1 –≤–ª–∞–¥–µ–ª–µ—Ü
–ü–æ–ª–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è, –ø–∞–Ω–æ—Ä–∞–º–∞
–¶–µ–Ω–∞ 2 –º–ª–Ω ‚ÇΩ
@username
```
+ 1 —Ñ–æ—Ç–æ –º–∞—à–∏–Ω—ã

**–í–∞—Ä–∏–∞–Ω—Ç 2: –í–∏–¥–µ–æ**
```
Audi A4 2018, –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
–ü–æ–ª–Ω—ã–π —Å–µ—Ä–≤–∏—Å —É –¥–∏–ª–µ—Ä–∞
–¶–µ–Ω–∞ 1.5 –º–ª–Ω
```
+ –≤–∏–¥–µ–æ –º–∞—à–∏–Ω—ã

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ù–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ (–º–µ–¥–∏–∞-–≥—Ä—É–ø–ø–∞)**
```
Mercedes E-–∫–ª–∞—Å—Å 2016
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è
```
+ 3-5 —Ñ–æ—Ç–æ

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤

–û—Ç–∫—Ä–æ–π—Ç–µ 3 —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:

**–¢–µ—Ä–º–∏–Ω–∞–ª 1: –ú–æ–Ω–∏—Ç–æ—Ä**
```bash
tail -f logs/monitor_output.log
```
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚úÖ Message processed and saved: Post ID=123
üíæ Saved post 123 to database (media_files=['photo:...'])
üéØ Queued post 123 for AI processing
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2: Celery Worker (AI + Publishing)**
```bash
tail -f logs/celery_worker_output.log
```
–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
ü§ñ Processing post 123
‚úì AI classification complete
‚úì Car data extracted
Attempting to copy message 456 from -1001234567890
‚úì Successfully copied message 456
‚úì Published post 123: media message 789, caption message 790
Successfully published post 123 to channel
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 3: Bot output**
```bash
tail -f logs/bot_output.log
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à **–Ω–æ–≤–æ—Å—Ç–Ω–æ–π –∫–∞–Ω–∞–ª** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

‚úÖ **–î–ª—è –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ:**
- [ ] –ú–µ–¥–∏–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ
- [ ] –ü–æ–¥ –º–µ–¥–∏–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
- [ ] –ï—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã üìû"
- [ ] –¢–µ–∫—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω (—ç–º–æ–¥–∑–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

‚úÖ **–î–ª—è –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø—ã:**
- [ ] –•–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ñ–æ—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ (–ø–µ—Ä–≤–æ–µ –∏–∑ –≥—Ä—É–ø–ø—ã)
- [ ] –¢–µ–∫—Å—Ç –∏ –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç

‚úÖ **–û–±—â–µ–µ:**
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
- [ ] –¶–µ–Ω–∞ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è
- [ ] –ê–≤—Ç–æ—Ç–µ–∫–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ unknown

### 5. –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

#### –ú–µ–¥–∏–∞ –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö:**
```bash
grep -i "copy_message failed" logs/celery_worker_output.log
grep -i "forward_message also failed" logs/celery_worker_output.log
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ë–æ—Ç –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∫–∞–Ω–∞–ª—É
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –±–æ—Ç–∞ –≤ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–∞–Ω–∞–ª —Ö–æ—Ç—è –±—ã —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ —á—Ç–µ–Ω–∏–µ
   
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç channel_id
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Google Sheets, —á—Ç–æ channel_id –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   - –ü—Ä–∏–º–µ—Ä—ã: `-1001234567890`, `@channelname`

3. –°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–∞ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

#### –ü–æ—Å—Ç—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# Celery worker –∑–∞–ø—É—â–µ–Ω?
ps aux | grep celery

# –ï—Å—Ç—å –æ—à–∏–±–∫–∏?
tail -50 logs/celery_worker_output.log
```

#### AI –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```bash
# OpenAI API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω?
grep OPENAI_API_KEY .env

# –õ–æ–≥–∏ AI –æ–±—Ä–∞–±–æ—Ç–∫–∏
grep "AI processing" logs/celery_worker_output.log
```

### 6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –ø–æ—Å—Ç–æ–≤ –≤ –±–∞–∑–µ:**
```bash
# –ß–µ—Ä–µ–∑ psql
psql postgresql://cars_bot_user:change_this_secure_password@localhost:5432/cars_bot -c "SELECT id, source_channel_id, original_message_id, media_files IS NOT NULL as has_media, published FROM posts ORDER BY date_found DESC LIMIT 10;"
```

**–û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å Celery:**
```bash
celery -A cars_bot.celery_app purge -f
```

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:**
```bash
./scripts/stop_celery.sh
pkill -f check_monitor.py
sleep 3
./scripts/run_all.sh
```

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –∫–æ–¥–µ

### Message Processor (`message_processor.py`)
- –¢–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ–¥–∏–∞: `type:id:access_hash:file_reference`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

### Publishing Service (`service.py`)
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `channel_id` (—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã)
- –î–≤–æ–π–Ω–æ–π fallback: `copy_message` ‚Üí `forward_message` ‚Üí `text_only`
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `InputMediaVideo`

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

‚ö†Ô∏è **–ú–µ–¥–∏–∞-–≥—Ä—É–ø–ø—ã (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ):**
- –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ **–ø–µ—Ä–≤–æ–µ** –º–µ–¥–∏–∞ –∏–∑ –≥—Ä—É–ø–ø—ã
- –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram API
- –î–ª—è –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω—É–∂–Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∞

‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- –û–¥–Ω–æ —Ñ–æ—Ç–æ ‚úì
- –û–¥–Ω–æ –≤–∏–¥–µ–æ ‚úì
- –î–æ–∫—É–º–µ–Ω—Ç—ã ‚úì
- –¢–µ–∫—Å—Ç –±–µ–∑ –º–µ–¥–∏–∞ ‚úì

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –º–µ–¥–∏–∞, –º–æ–∂–Ω–æ:

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø:**
   - –û–±–Ω–æ–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö message_id –≥—Ä—É–ø–ø—ã
   - –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã
   - –ò–ª–∏ —Å–∫–∞—á–∏–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ `send_media_group`

2. **–î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞:**
   - –°–∫–∞—á–∏–≤–∞—Ç—å –º–µ–¥–∏–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ S3
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏

3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:**
   - Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω —á–∞—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

