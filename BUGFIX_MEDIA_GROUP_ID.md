# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞: media_group_id –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

**–û—à–∏–±–∫–∞:**
```
asyncpg.exceptions.DataError: invalid input for query argument $7: 14090806734303146 (value out of int32 range)
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
Telegram –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞ –¥–ª—è `media_group_id` (–¥–æ 64-–±–∏—Ç), –Ω–æ –≤ –º–æ–¥–µ–ª–∏ `Post` –ø–æ–ª–µ –±—ã–ª–æ –æ–±—ä—è–≤–ª–µ–Ω–æ –∫–∞–∫ `Integer` (32-–±–∏—Ç, –º–∞–∫—Å–∏–º—É–º ~2.1 –º–ª—Ä–¥).

–ó–Ω–∞—á–µ–Ω–∏–µ `14090806734303146` –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ int32.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò–∑–º–µ–Ω–µ–Ω–∞ –º–æ–¥–µ–ª—å
**–§–∞–π–ª:** `src/cars_bot/database/models/post.py`

**–ë—ã–ª–æ:**
```python
media_group_id: Mapped[Optional[int]] = mapped_column(
    Integer,  # ‚ùå –¢–æ–ª—å–∫–æ –¥–æ 2,147,483,647
    nullable=True,
    comment="Telegram grouped_id for media groups (albums)"
)
```

**–°—Ç–∞–ª–æ:**
```python
media_group_id: Mapped[Optional[int]] = mapped_column(
    BigInteger,  # ‚úÖ –î–æ 9,223,372,036,854,775,807
    nullable=True,
    comment="Telegram grouped_id for media groups (albums)"
)
```

**–ò–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:**
```python
from sqlalchemy import BigInteger, Boolean, Float, ...
```

### 2. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î

**–§–∞–π–ª:** `alembic/versions/2025_10_25_0026-e172e9fe894f_change_media_group_id_to_bigint.py`

```python
def upgrade() -> None:
    op.alter_column(
        'posts',
        'media_group_id',
        existing_type=sa.Integer(),
        type_=sa.BigInteger(),
        existing_nullable=True
    )
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–æ–π:**
```bash
alembic upgrade head
```

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –î–∏–∞–ø–∞–∑–æ–Ω—ã —Ç–∏–ø–æ–≤:

| –¢–∏–ø | –ú–∏–Ω–∏–º—É–º | –ú–∞–∫—Å–∏–º—É–º | Telegram ID |
|-----|---------|----------|-------------|
| **INTEGER** (int32) | -2,147,483,648 | 2,147,483,647 | ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ |
| **BIGINT** (int64) | -9,223,372,036,854,775,808 | 9,223,372,036,854,775,807 | ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ |

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è:
```
Telegram media_group_id: 14,090,806,734,303,146
INT32 –º–∞–∫—Å–∏–º—É–º:           2,147,483,647

14,090,806,734,303,146 > 2,147,483,647 ‚Üí –û–®–ò–ë–ö–ê!
```

## üöÄ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

‚úÖ –ú–µ–¥–∏–∞-–≥—Ä—É–ø–ø—ã —Å –ª—é–±—ã–º–∏ ID –æ—Ç Telegram —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ  
‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ –≤ –ë–î  
‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã (–º–∏–≥—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞)  

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ:

```
2025-10-25 03:07:20.366 | INFO | Processing media group 14090806734303146 with 7 messages
‚úÖ SUCCESS - –ì—Ä—É–ø–ø–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ë–î
```

## üìù –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `src/cars_bot/database/models/post.py` - –∏–∑–º–µ–Ω–µ–Ω —Ç–∏–ø –ø–æ–ª—è
2. ‚úÖ `alembic/versions/2025_10_25_0026-e172e9fe894f_change_media_group_id_to_bigint.py` - –º–∏–≥—Ä–∞—Ü–∏—è
3. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –∫–æ–ª–æ–Ω–∫–∞ `posts.media_group_id` —Ç–µ–ø–µ—Ä—å BIGINT

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–ï—Å–ª–∏ –≤—ã —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç–µ –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
cd /Users/edgark/CARS\ BOT
source venv/bin/activate
source scripts/export_env.sh
alembic upgrade head
```

## üéâ –°—Ç–∞—Ç—É—Å

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** ‚úÖ  
**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** ‚úÖ  
**–ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:** ‚úÖ  

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 25 –æ–∫—Ç—è–±—Ä—è 2025  
**Revision ID:** e172e9fe894f


